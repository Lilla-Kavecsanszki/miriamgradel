{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags bts_tags %}

{% block body_class %}template-communication{% endblock %}

{% block extra_css %}
  {# Reuse the journalism ribbon/aside styles #}
  <link rel="stylesheet" href="{% static 'css/journalism.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    {# ================= LEFT: HERO + INTRO + SERVICES ================= #}
    <div class="col-12 col-lg-8">

      <!-- Hero ribbon (same component as Written) -->
      <div class="written-hero mb-3">
        <span class="cap" aria-hidden="true"></span>
        <div class="block-title" style="color:#73f0fa">
          {{ page.title }}
        </div>
        {% if page.intro %}
          <p>{{ page.intro|richtext }}</p>
        {% endif %}
      </div>

      <h3 class="section-title"><span class="band">My Recent Work</span></h3>

      {# ===== Services grid (one card per service) ===== #}
      <div class="row">
        {% for blk in page.services %}
          {% if blk.block_type == "service" %}
          <div class="col-md-6 col-lg-6 mb-4" id="{{ blk.value.slug|default:blk.value.title|slugify }}">
            <div class="card h-100 border-0 shadow-sm">
              {% if blk.value.image %}
                {% image blk.value.image fill-600x360 class="card-img-top" %}
              {% endif %}
              <div class="card-body d-flex flex-column">
                <h3 class="h5 mb-2">{{ blk.value.title }}</h3>
                <div class="mb-3 small text-muted">{{ blk.value.details|richtext }}</div>

                {% if blk.value.examples %}
                  <h4 class="h6 mt-2">Examples / Projects</h4>
                  <ul class="list-unstyled mb-3">
                    {% for ex in blk.value.examples %}
                      <li class="mb-2 d-flex">
                        {% if ex.image %}
                          <div class="me-2" style="width:56px;height:56px;overflow:hidden;border-radius:.5rem;">
                            {% image ex.image fill-112x112 class="img-fluid" %}
                          </div>
                        {% endif %}
                        <div>
                          <div class="fw-semibold">{{ ex.title }}</div>
                          {% if ex.description %}<div class="small text-muted">{{ ex.description }}</div>{% endif %}
                          {% if ex.link_url and ex.link_label %}
                            <a class="small" href="{{ ex.link_url }}" target="_blank" rel="noopener">{{ ex.link_label }}</a>
                          {% endif %}
                        </div>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}

                {% if blk.value.outputs %}
                  <h4 class="h6">Outputs / Tasks</h4>
                  <ul class="list-group list-group-flush">
                    {% for out in blk.value.outputs %}
                      <li class="list-group-item">{{ out }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}
        {% endfor %}
      </div>

      {# ===== Optional: Project highlights row ===== #}
      {% if page.project_highlights %}
        <h3 class="section-title mt-4"><span class="band">Project highlights</span></h3>
        <div class="row">
          {% for hi in page.project_highlights %}
            {% if hi.block_type == "highlight" %}
              <div class="col-md-6 col-lg-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                  {% if hi.value.image %}
                    {% image hi.value.image fill-600x360 class="card-img-top" %}
                  {% endif %}
                  <div class="card-body d-flex flex-column">
                    <h3 class="h6">{{ hi.value.title }}</h3>
                    {% if hi.value.description %}
                      <p class="small text-muted">{{ hi.value.description }}</p>
                    {% endif %}
                    {% if hi.value.link_url and hi.value.link_label %}
                      <a class="btn btn-outline-dark btn-sm mt-auto" href="{{ hi.value.link_url }}" target="_blank" rel="noopener">
                        {{ hi.value.link_label }}
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {# ================= RIGHT: BTS SIDEBAR ================= #}
    <div class="col-12 col-lg-4 mt-4 mt-lg-0">
      <aside class="bts-aside">
        <h3 class="section-title">Behind the Scenes</h3>
        
        {% bts_teasers_for 'communication' 3 as bts_teasers %}

        {% if bts_teasers %}
          <ul class="list-unstyled">
            {% for bts in bts_teasers %}
              <li class="mb-3">
                <article class="bts-card bts-card--sidebar">
                  {% if bts.teaser_image %}
                    <a href="{{ bts.url }}" class="thumb">
                      {% image bts.teaser_image fill-600x338 class="w-100" loading="lazy" decoding="async" alt=bts.card_title %}
                      <span class="bts-title">{{ bts.card_title }}</span>
                    </a>
                  {% else %}
                    <a href="{{ bts.url }}" class="thumb">
                      <span class="bts-title">{{ bts.card_title }}</span>
                    </a>
                  {% endif %}

                  <div class="bts-body">
                    {% if bts.card_summary %}
                      <p class="bts-text">{{ bts.card_summary }}</p>
                    {% endif %}
                    <a href="{{ bts.url }}" class="bts-cta">Discover how it happened!</a>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">More behind-the-scenes coming soon.</p>
        {% endif %}
      </aside>
    </div>
  </div>
</div>
{% endblock %}
