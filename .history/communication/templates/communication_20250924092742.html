{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags bts_tags %}

{% block body_class %}template-communication{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/journalism.css' %}">
  <link rel="stylesheet" href="{% static 'css/communication.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container-fluid py-4">

  <!-- First row: hero + tile grid on the left, BTS sidebar on the right -->
  <div class="row">
    <div class="col-12 col-lg-8">

      <!-- Hero ribbon -->
      <div class="written-hero mb-3">
        <span class="cap" aria-hidden="true"></span>
        <div class="block-title" style="color:#73f0fa">{{ page.title }}</div>
        {% if page.intro %}
          {{ page.intro|richtext }}
        {% endif %}
      </div>

      <!-- Section heading for service tiles -->
      <h3 class="section-title">
        <span class="band">click on the service below to know more</span>
      </h3>
      <!-- top anchor -->
      <a id="top"></a>

      <!-- Service anchor tiles -->
      {% if page.services %}
      <section class="svc-tiles mb-4">
        <div class="row row-cols-2 row-cols-md-3 row-cols-xl-5 g-3">
          {% for service in page.services %}
            {% with service.value as svc %}
            <div class="col">
              <a class="card tile border-0 h-100 text-decoration-none"
                 href="#{{ svc.slug|default:svc.title|slugify }}"
                 aria-label="Jump to {{ svc.title }}">
                <div class="card-body d-flex flex-column justify-content-end p-3 p-md-4">
                  <h4 class="h6 fw-bold mb-0 tile-title">{{ svc.title }}</h4>
                </div>
              </a>
            </div>
            {% endwith %}
          {% endfor %}
        </div>
      </section>
      {% endif %}

    </div><!-- /col-8 -->

    <div class="col-12 col-lg-4 mt-4 mt-lg-0">
      <!-- BTS sidebar stays in the first row -->
      <aside class="bts-aside">
        <h3 class="section-title">Behind the Scenes</h3>
        {% bts_teasers_for 'communication' 3 as bts_teasers %}
        {% if bts_teasers %}
        <ul class="list-unstyled">
          {% for bts in bts_teasers %}
          <li class="mb-3">
            <article class="bts-card bts-card--sidebar">
              {% if bts.teaser_image %}
              <a href="{{ bts.url }}" class="thumb">
                {% image bts.teaser_image fill-600x338 class="w-100" loading="lazy" decoding="async" alt=bts.card_title %}
                <span class="bts-title">{{ bts.card_title }}</span>
              </a>
              {% else %}
              <a href="{{ bts.url }}" class="thumb">
                <span class="bts-title">{{ bts.card_title }}</span>
              </a>
              {% endif %}
              <div class="bts-body">
                {% if bts.card_summary %}
                <p class="bts-text">{{ bts.card_summary }}</p>
                {% endif %}
                <a href="{{ bts.url }}" class="bts-cta">Discover how it happened!</a>
              </div>
            </article>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">More behind-the-scenes coming soon.</p>
        {% endif %}
      </aside>
    </div><!-- /col-4 -->
  </div><!-- /first row -->

  <!-- Subsequent rows: each service section on its own row -->
  {% for service in page.services %}
    {% with service.value as svc %}
    <div class="row">
      <div class="col-12">
        <section id="{{ svc.slug|default:svc.title|slugify }}"
                 class="svc-section mb-5{% if forloop.counter|divisibleby:2 %} svc-section--alt{% endif %}">
          <h3 class="section-title">
            <span class="band">{{ svc.title }}</span>
          </h3>
          <div class="row gx-3 gy-4 align-items-start">
            <div class="col-12 col-lg-7">
              {{ svc.details|richtext }}
              {% if svc.outputs %}
              <h4>Outputs:</h4>
              <ul>
                {% for output in svc.outputs %}
                <li>{{ output }}</li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
            <div class="col-12 col-lg-5">
              {% if svc.image %}
                {% image svc.image fill-600x400 class="img-fluid" alt=svc.title %}
              {% endif %}
            </div>
          </div>
          {% if svc.examples %}
          <div class="svc-examples mt-4">
            <h4>Examples</h4>
            <div class="row row-cols-1 row-cols-md-2 g-3">
              {% for ex in svc.examples %}
              <div class="col">
                <article class="example-card p-3 border">
                  {% if ex.image %}
                    {% image ex.image fill-600x338 class="img-fluid mb-2" alt=ex.title %}
                  {% endif %}
                  <h5>{{ ex.title }}</h5>
                  {% if ex.description %}
                  <p>{{ ex.description }}</p>
                  {% endif %}
                  {% if ex.link_url %}
                    <button type="button"
                            class="example-button"
                            onclick="window.open('{{ ex.link_url }}', '_blank', 'noopener');">
                      {{ ex.link_label|default:"Learn more" }}
                    </button>
                  {% endif %}
                </article>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </section>
      </div>
    </div>
    {% endwith %}
  {% endfor %}
 
  <a href="#top" class="to-top-button" aria-label="Back to top">
    <span class="arrow" aria-hidden="true">â†‘</span>
    <span class="label">Back to top</span>
  </a>

</div><!-- /container-fluid -->
{% endblock %}
