{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags bts_tags i18n %}

{% block body_class %}template-communication{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/journalism.css' %}">
  <link rel="stylesheet" href="{% static 'css/communication.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container-fluid py-2">

  <a id="top"></a>

  <!-- Row 1: Hero + service tiles (left) / BTS sidebar (right) -->
  <div class="row">
    <div class="col-12 col-lg-8">

      <!-- Hero ribbon -->
      <div class="written-hero mb-3">
        <span class="cap" aria-hidden="true"></span>
        <h1 class="block-title m-0" style="color:#73f0fa">{{ page.title }}</h1>
        {% if page.intro %}
          <div class="mt-2">
            {{ page.intro|richtext }}
          </div>
        {% endif %}
      </div>

      <!-- Service tiles heading -->
      <h3 class="section-title">
        <span class="band">{% trans "Here is where I excel" %}</span>
      </h3>

      <!-- Service anchor tiles -->
      {% if page.services %}
      <section class="svc-index mb-4">
        <ul class="svc-links list-unstyled" role="list">
          {% for service in page.services %}
            {% with svc=service.value %}
              <li>
                <a class="svc-link"
                  href="#{% if svc.slug %}{{ svc.slug|slugify }}{% elif svc.title %}{{ svc.title|slugify }}{% else %}section-{{ forloop.counter }}{% endif %}"
                  aria-label="{% blocktrans with t=svc.title|default:_('Service') %}Jump to {{ t }}{% endblocktrans %}">
                  <span class="svc-title">
                    {% if svc.title %}
                      {{ svc.title }}
                    {% else %}
                      {% trans "Service" %} {{ forloop.counter }}
                    {% endif %}
                  </span>
                </a>
              </li>
            {% endwith %}
          {% endfor %}
        </ul>
      </section>
      {% endif %}

    </div><!-- /col-8 -->

    <!-- BTS sidebar -->
    <div class="col-12 col-lg-4 mt-4 mt-lg-0">
      <aside class="bts-aside">
        <h3 class="section-title">{% trans "Behind the Scenes" %}</h3>
        {% bts_teasers_for 'communication' 3 as bts_teasers %}
        {% if bts_teasers %}
          <ul class="list-unstyled">
            {% for bts in bts_teasers %}
              <li class="mb-3">
                <article class="bts-card bts-card--sidebar">
                  <a href="{{ bts.url }}" class="thumb text-decoration-none" aria-label="{{ bts.card_title }}">
                    {% if bts.teaser_image %}
                      {% image bts.teaser_image fill-600x338 class="w-100" loading="lazy" decoding="async" alt=bts.card_title %}
                    {% endif %}
                    <span class="bts-title d-inline-block mt-2">{{ bts.card_title }}</span>
                  </a>
                  <div class="bts-body">
                    {% if bts.card_summary %}
                      <p class="bts-text">{{ bts.card_summary }}</p>
                    {% endif %}
                    <a href="{{ bts.url }}" class="bts-cta">{% trans "Discover how it happened!" %}</a>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">{% trans "More behind-the-scenes coming soon." %}</p>
        {% endif %}
      </aside>
    </div><!-- /col-4 -->
  </div><!-- /row -->

  <!-- Rows 2+: each service section -->
  {% if page.services %}
    {% for service in page.services %}
      {% with svc=service.value %}
        <div class="row">
          <div class="col-12">
            <section
              id="{% if svc.slug %}{{ svc.slug|slugify }}{% elif svc.title %}{{ svc.title|slugify }}{% else %}section-{{ forloop.counter }}{% endif %}"
              class="svc-section mb-1{% if forloop.counter|divisibleby:2 %} svc-section--alt{% endif %}"
            >
              <h3 class="section-title">
                {% if svc.title %}
                  <span class="band">{{ svc.title }}</span>
                {% else %}
                  <span class="band">{% trans "Service" %} {{ forloop.counter }}</span>
                {% endif %}
              </h3>

              {# CONTENT ROW: text 2/3, image 1/3 (image right) when image exists #}
              <div class="row gx-4 gy-4 align-items-start">

                {# TEXT COLUMN #}
                <div class="{% if svc.image %}col-12 col-lg-8{% else %}col-12{% endif %}">

                  {# 1) Body – Description #}
                  {% if svc.details %}
                    <div class="svc-details">
                      {{ svc.details|richtext }}
                    </div>
                  {% endif %}

                  {# 2) Offering #}
                  {% if svc.offering %}
                    <div class="svc-offering mt-4">
                      <h4 class="mb-2">{% trans "Offering:" %}</h4>
                      {{ svc.offering|richtext }}
                    </div>
                  {% endif %}

                  {# 4) Example #}
                  {% if svc.example %}
                    <div class="svc-examples mt-4">
                      <h4 class="mb-2">{% trans "Example:" %}</h4>
                      {{ svc.example|richtext }}
                    </div>
                  {% endif %}

                  {# 5) Output #}
                  {% if svc.output %}
                    <div class="svc-outputs mt-4">
                      <h4 class="mb-2">{% trans "Output:" %}</h4>
                      {{ svc.output|richtext }}
                    </div>
                  {% endif %}

                </div>

                {# IMAGE COLUMN (RIGHT) #}
                {% if svc.image %}
                  <div class="col-12 col-lg-4 order-lg-2">
                    <div class="svc-image-square ratio ratio-1x1 rounded overflow-hidden">
                      {% image svc.image fill-800x800 class="svc-img" loading="lazy" decoding="async" alt=svc.title %}
                    </div>
                  </div>
                {% endif %}

              </div>

            </section>
          </div>
        </div>
      {% endwith %}
    {% endfor %}
  {% endif %}

  {# Bottom section: embedded videos (Instagram, YouTube, etc.) #}
  {% if page.instagram_reels %}
    <section class="insta-reels mt-5">
      {% comment %} <h3 class="section-title">
        <span class="band">{% trans "Selected work" %}</span>
      </h3> {% endcomment %}

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
        {% for item in page.instagram_reels %}
          {% with code=item.value.embed_code %}
            <div class="col d-flex justify-content-center">
              <div class="video-embed-wrapper w-100">
                {{ code|safe }}
              </div>
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    </section>
  {% endif %}

  <!-- Back to top button -->
  <a href="#top" class="to-top-button" aria-label="{% trans 'Back to top' %}">
    <span class="arrow" aria-hidden="true">↑</span>
    <span class="label">{% trans "Back to top" %}</span>
  </a>

</div><!-- /container-fluid -->
{% endblock %}
