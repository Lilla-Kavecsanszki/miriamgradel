{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-written-index{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <!-- Left: Articles -->
    <div class="col-12 col-lg-8">

      {% if page.intro %}
        <div class="written-hero mb-3">
          {{ page.intro|richtext }}
        </div>
      {% endif %}

      {% now "Y" as current_year %}

      <h2 class="block-title mb-2">Discover here some of my articles</h2>

      <!-- This year -->
      <div class="written-section">
        <h3 class="section-title">My work — {{ current_year }}</h3>
        <ul class="written-list">
          {% for a in articles %}
            {% if a.publication_date and a.publication_date|date:"Y" == current_year %}
              <li class="written-item">
                <a href="{% if a.external_url %}{{ a.external_url }}{% else %}{% pageurl a %}{% endif %}"
                   {% if a.external_url %}target="_blank" rel="noopener"{% endif %}>
                  <span class="title">{{ a.title }}</span>
                  {% if a.publication_name %}<span class="dot">•</span><span class="pub">{{ a.publication_name }}</span>{% endif %}
                  {% if a.publication_date %}<span class="dot">•</span><span class="date">{{ a.publication_date|date:"d/m/Y" }}</span>{% endif %}
                </a>
              </li>
            {% endif %}
          {% empty %}
            <li class="text-muted">No articles yet.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Previous years -->
      <div class="written-section mt-4">
        <h3 class="section-title">My previous works</h3>
        <ul class="written-list">
          {% for a in articles %}
            {% if not a.publication_date or a.publication_date|date:"Y" != current_year %}
              <li class="written-item">
                <a href="{% if a.external_url %}{{ a.external_url }}{% else %}{% pageurl a %}{% endif %}"
                   {% if a.external_url %}target="_blank" rel="noopener"{% endif %}>
                  <span class="title">{{ a.title }}</span>
                  {% if a.publication_name %}<span class="dot">•</span><span class="pub">{{ a.publication_name }}</span>{% endif %}
                  {% if a.publication_date %}<span class="dot">•</span><span class="date">{{ a.publication_date|date:"d/m/Y" }}</span>{% endif %}
                </a>
              </li>
            {% endif %}
          {% empty %}
            <li class="text-muted">No earlier articles available.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <!-- Right: Behind the Scenes teasers -->
    <div class="col-12 col-lg-4 mt-4 mt-lg-0">
      <aside class="bts-aside">
        <h3 class="section-title">Behind the Scenes</h3>
        {% for b in bts_items %}
          <article class="bts-card">
            {% if b.lead_image %}
              <a href="{% pageurl b %}" class="thumb">
                {% image b.lead_image fill-400x250 class="img-fluid" %}
              </a>
            {% endif %}
            <div class="bts-body">
              <h4 class="bts-title"><a href="{% pageurl b %}">{{ b.title }}</a></h4>
              {% if b.teaser %}
                <p class="bts-text">{{ b.teaser|truncatewords:30 }}</p>
              {% endif %}
              <a class="bts-cta" href="{% pageurl b %}">Discover what happened…</a>
            </div>
          </article>
        {% empty %}
          <p class="text-muted">More behind-the-scenes coming soon.</p>
        {% endfor %}
      </aside>
    </div>
  </div>
</div>
{% endblock %}
