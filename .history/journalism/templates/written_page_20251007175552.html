{% extends "base.html" %}
{% load static i18n wagtailcore_tags wagtailimages_tags bts_tags %}

{% block body_class %}template-written-index{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/journalism.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <!-- ================= LEFT: hero + lists ================= -->
    <div class="col-12 col-lg-8">

      <!-- Hero ribbon -->
      <div class="written-hero mb-3">
        <span class="cap" aria-hidden="true"></span>
        <div class="block-title" style="color:#73f0fa">
          {% trans "Discover here some of my articles" %}
        </div>
        <p>{% trans "I had the chance to work for 10 years for different magazines. Here’s a small selection." %}</p>
      </div>

      {% if page.intro %}
        <div class="mb-3">{{ page.intro|richtext }}</div>
      {% endif %}

      <!-- My work — current year -->
      <h3 class="section-title">
        <span class="band">{% trans "My Recent Work" %}</span>
      </h3>
      <ul class="written-list" aria-label="{% trans 'Recent articles' %}">
        {% for a in recent_articles %}
          {% with d=a.publication_date %}
          <li class="written-item written-row">
            {% if a.external_url %}
              <a href="{{ a.external_url }}" target="_blank" rel="noopener" class="w-title w-title--link">{{ a.title }}</a>
            {% else %}
              <span class="w-title w-title--nolink">{{ a.title }}</span>
            {% endif %}

            {% if a.publication_name %}
              <span class="w-dot" aria-hidden="true">·</span>
              <span class="w-pub">{{ a.publication_name }}</span>
            {% endif %}

            {% if d %}
              <span class="w-dot" aria-hidden="true">·</span>
              <time class="w-date" datetime="{{ d|date:'Y-m-d' }}">{{ d|date:"Y" }}</time>
            {% endif %}
          </li>
          {% endwith %}
        {% empty %}
          <li class="written-item text-muted">
            {% blocktrans with y=current_year %}No articles for {{ y }} yet.{% endblocktrans %}
          </li>
        {% endfor %}
      </ul>

      <!-- My previous works -->
      <h3 class="section-title mt-4">
        <span class="band">{% trans "My previous works" %}</span>
      </h3>
      <ul class="written-list" aria-label="{% trans 'Previous articles' %}">
        {% for a in previous_articles %}
          {% with d=a.publication_date %}
          <li class="written-item written-row">
            {% if a.external_url %}
              <a href="{{ a.external_url }}" target="_blank" rel="noopener" class="w-title w-title--link">{{ a.title }}</a>
            {% else %}
              <span class="w-title w-title--nolink">{{ a.title }}</span>
            {% endif %}

            {% if a.publication_name %}
              <span class="w-dot" aria-hidden="true">·</span>
              <span class="w-pub">{{ a.publication_name }}</span>
            {% endif %}

            {% if d %}
              <span class="w-dot" aria-hidden="true">·</span>
              <time class="w-date" datetime="{{ d|date:'Y-m-d' }}">{{ d|date:"d/m/Y" }}</time>
            {% endif %}
          </li>
          {% endwith %}
        {% empty %}
          <li class="written-item text-muted">{% trans "No older articles yet." %}</li>
        {% endfor %}
      </ul>

    </div>

    <!-- ================= RIGHT: Behind the Scenes teasers ================= -->
    <div class="col-12 col-lg-4 mt-4 mt-lg-0">
      <aside class="bts-aside">
        <h3 class="section-title"><span>{% trans "Behind the Scenes" %}</span></h3>

        {% bts_teasers_for 'written' 3 as bts_teasers %}
        {% if bts_teasers %}
          <ul class="list-unstyled">
            {% for bts in bts_teasers %}
              <li class="mb-3">
                <article class="bts-card bts-card--sidebar">
                  <a href="{{ bts.url }}" class="thumb">
                    {% if bts.teaser_image %}
                      {% image bts.teaser_image fill-600x338 class="w-100" loading="lazy" decoding="async" alt=bts.card_title %}
                    {% endif %}
                    <span class="bts-title">{{ bts.card_title }}</span>
                  </a>
                  <div class="bts-body">
                    {% if bts.card_summary %}
                      <p class="bts-text">{{ bts.card_summary }}</p>
                    {% endif %}
                    <a href="{{ bts.url }}" class="bts-cta">
                      {% trans "Discover how it happened!" %}
                    </a>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">{% trans "More behind-the-scenes coming soon." %}</p>
        {% endif %}
      </aside>
    </div>
  </div>
</div>
{% endblock %}
