{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-audio{% endblock %}

{% block content %}
<section class="container my-5">
  <div class="row g-5">

    <!-- LEFT: title/intro + episodes -->
    <div class="col-12 col-lg-8">
      <h1 class="mb-3">{{ page.title }}</h1>
      {% if page.intro %}<div class="lead mb-4">{{ page.intro|richtext }}</div>{% endif %}

      {% for blk in page.episodes|dictsortreversed:"value.date" %}
        {% if blk.block_type == "episode" %}
          <article class="mb-5">
            <h2 class="h5 mb-2">{{ blk.value.title }}</h2>
            {% if blk.value.date %}
              <div class="small text-muted mb-2">{{ blk.value.date|date:"M j, Y" }}</div>
            {% endif %}

            <div class="ratio ratio-16x9 mb-2">
              {{ blk.value.embed }}
            </div>

            {% if blk.value.teaser %}
              <p class="small text-muted">{{ blk.value.teaser }}</p>
            {% endif %}

            {# optional: keep any per-episode BTS link you already have #}
            {% if blk.value.behind_scenes.page %}
              <a class="btn btn-outline-dark btn-sm" href="{% pageurl blk.value.behind_scenes.page %}">
                {{ blk.value.behind_scenes.label }}
              </a>
            {% endif %}
          </article>
        {% endif %}
      {% empty %}
        <p>No episodes yet.</p>
      {% endfor %}
    </div>

    <!-- RIGHT: BTS teaser cards (Audio category) -->
    <div class="col-12 col-lg-4">
      <aside class="bts-aside">
        <h3 class="h5 mb-3">Behind the Scenes</h3>

        {% if bts_teasers %}
          <ul class="list-unstyled">
            {% for bts in bts_teasers %}
              <li class="mb-3">
                <article class="bts-card d-flex">
                  {% if bts.teaser_image %}
                    <a href="{{ bts.url }}" class="me-3" style="width: 120px;">
                      {% image bts.teaser_image fill-120x68 class="rounded w-100" %}
                    </a>
                  {% endif %}
                  <div class="flex-grow-1">
                    <h4 class="h6 mb-1">
                      <a href="{{ bts.url }}" class="text-decoration-none">{{ bts.card_title }}</a>
                    </h4>
                    {% if bts.card_summary %}
                      <p class="mb-1 small text-muted">{{ bts.card_summary }}</p>
                    {% endif %}
                    <a href="{{ bts.url }}" class="bts-cta small">Read the BTS â†’</a>
                  </div>
                </article>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">More behind-the-scenes coming soon.</p>
        {% endif %}
      </aside>
    </div>

  </div>
</section>
{% endblock %}
