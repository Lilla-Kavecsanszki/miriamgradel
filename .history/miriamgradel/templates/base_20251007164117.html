{% load static wagtailcore_tags wagtailuserbar i18n cache %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'en' }}">
<head>
  <meta charset="utf-8" />
  <title>
    {% block title %}
      {% if page.seo_title %}{{ page.seo_title }}{% else %}{{ page.title }}{% endif %}
    {% endblock %}
    {% block title_suffix %}
      {% wagtail_site as current_site %}
      {% if current_site and current_site.site_name %}- {{ current_site.site_name }}{% endif %}
    {% endblock %}
  </title>

  {% if page.search_description %}
    <meta name="description" content="{{ page.search_description }}" />
  {% endif %}
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  {# Canonical URL #}
  {% if page %}
    <link rel="canonical" href="{{ page.full_url|default:request.build_absolute_uri }}">
  {% endif %}

  {# hreflang alternates (current + other translations) #}
  {% if page and page.id %}
    <link rel="alternate" hreflang="{{ page.locale.language_code }}" href="{{ page.full_url|default:page.url }}">
    {% for t in page.get_translations %}
      <link rel="alternate" hreflang="{{ t.locale.language_code }}" href="{{ t.url }}">
    {% endfor %}
  {% endif %}

  {% if request.in_preview_panel %}
    <base target="_blank">
  {% endif %}

  {# --- Performance hints --- #}
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preload" as="font" href="{% static 'fonts/TT Chocolates Trial Regular.otf' %}" type="font/otf" crossorigin>
  <link rel="preload" as="font" href="{% static 'fonts/TT Chocolates Trial DemiBold.otf' %}" type="font/otf" crossorigin>
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">

  <!-- Embeds (YouTube/Vimeo) -->
  <link rel="preconnect" href="https://www.youtube.com">
  <link rel="preconnect" href="https://i.ytimg.com">
  <link rel="preconnect" href="https://www.youtube-nocookie.com">
  <link rel="preconnect" href="https://player.vimeo.com">
  <link rel="preconnect" href="https://i.vimeocdn.com">
  <link rel="dns-prefetch" href="//www.youtube.com">
  <link rel="dns-prefetch" href="//i.ytimg.com">
  <link rel="dns-prefetch" href="//www.youtube-nocookie.com">
  <link rel="dns-prefetch" href="//player.vimeo.com">
  <link rel="dns-prefetch" href="//i.vimeocdn.com">

  {# --- Social / Rich cards --- #}
  {% if page %}
    <meta property="og:type" content="website">
    <meta property="og:title" content="{% firstof page.seo_title page.title %}">
    <meta property="og:description" content="{{ page.search_description|default_if_none:'' }}">
    <meta property="og:url" content="{{ page.full_url|default:request.build_absolute_uri }}">
    {% block meta_image %}
      <meta property="og:image" content="{{ request.site.root_url }}{% static 'images/og-default.jpg' %}">
      <meta name="twitter:card" content="summary_large_image">
    {% endblock %}
  {% endif %}

  {# --- Assets --- #}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        referrerpolicy="no-referrer">
  <link rel="icon" href="{% static 'favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">

  {% block extra_css %}{% endblock %}

  {# Structured data (Person) #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Miriam Gradel",
    "url": "{{ request.site.root_url }}",
    "image": "{{ request.site.root_url }}{% static 'images/logo.png' %}",
    "sameAs": [
      "https://www.linkedin.com/in/miriam-gradel/",
      "https://www.instagram.com/migradel/",
      "https://bsky.app/profile/mgradel.bsky.social"
    ]
  }
  </script>
</head>

<body class="{% block body_class %}{% endblock %}">
  {% wagtailuserbar %}

  {# Resolve URLs ONCE, outside cached blocks (used by sidebar, footer, mobile top bar) #}
  {% slugurl 'home' as home_url %}
  {% slugurl 'written-page' as written_url %}
  {% slugurl 'audio-page' as audio_url %}
  {% slugurl 'video-page' as videos_url %}
  {% slugurl 'communication' as communication_url %}
  {% slugurl 'behind-the-scenes' as bts_url %}
  {% slugurl 'work-with-me' as work_url %}

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay d-grid place-items-center">
    <img src="{% static 'images/logo.png' %}" alt="Logo" loading="lazy" class="loading-logo img-fluid">
  </div>

  {# =================== SIDEBAR / DRAWER (cached) =================== #}
  {% block side_menu %}
  {% cache 600 "side_menu" request.path LANGUAGE_CODE %}
  <aside id="side-menu"
         class="side-menu"
         aria-label="{% trans 'Site menu' %}"
         aria-hidden="true">
    <!-- Close (mobile only) -->
    <button class="menu-close d-lg-none btn" type="button" aria-label="{% trans 'Close menu' %}">×</button>

    <div class="menu-container d-flex flex-column text-center">

      {# Text logo → Home #}
      <a class="menu-logo text-decoration-none" href="{{ home_url|default:'/' }}">
        <span class="logo-line">Miriam</span><br>
        <span class="logo-line">Gradel</span>
      </a>

      <nav class="main-menu mt-3">
        <ul class="menu-root list-unstyled m-0 p-2">
          <!-- Journalism dropdown (handled by miriamgradel.js) -->
          <li class="has-submenu">
            <button
              class="menu-toggle w-100 d-flex justify-content-center align-items-center btn bg-transparent border-0"
              type="button"
              aria-expanded="false"
              aria-controls="submenu-journalism">
              <span class="j-dropdown">{% trans "Journalism" %}</span>
              <span class="chevron ms-2" aria-hidden="true">▾</span>
            </button>

            <ul id="submenu-journalism" class="submenu list-unstyled" hidden>
              <li><a class="submenu-link{% if request.path == written_url %} is-active{% endif %}" href="{{ written_url }}">{% trans "Written" %}</a></li>
              <li><a class="submenu-link{% if request.path == audio_url %} is-active{% endif %}" href="{{ audio_url }}">{% trans "Audio" %}</a></li>
              <li><a class="submenu-link{% if request.path == videos_url %} is-active{% endif %}" href="{{ videos_url }}">{% trans "Video" %}</a></li>
            </ul>
          </li>

          <li class="divider" aria-hidden="true"></li>
          <li><a class="menu-link" href="{{ communication_url }}">{% trans "Communication" %}</a></li>

          <li class="divider" aria-hidden="true"></li>
          <li><a class="menu-link" href="{{ bts_url }}">{% trans "Behind the Scenes" %}</a></li>

          <li class="divider" aria-hidden="true"></li>
          <li><a class="menu-link" href="{{ work_url }}">{% trans "Work with Me" %}</a></li>
        </ul>
      </nav>

      {# Image logo — responsive #}
      <div class="logo my-2">
        <img src="{% static 'images/logo.png' %}" alt="Miriam Gradel" class="logo-img img-fluid mx-auto d-block">
      </div>

      <!-- Bottom: language (auto) + socials -->
      <div class="menu-bottom mt-auto">
        {# Language switcher: current page + other translations (only locales that exist) #}
        {% if page and page.id %}
          <ul class="list-inline small mb-3">
            <li class="list-inline-item">
              <a class="text-decoration-none {% if page.locale.language_code == LANGUAGE_CODE %}fw-bold{% endif %}"
                 hreflang="{{ page.locale.language_code }}"
                 href="{{ page.url }}">
                 {{ page.locale.get_display_name }}
              </a>
            </li>
            {% for t in page.get_translations %}
              <li class="list-inline-item">
                <a class="text-decoration-none {% if t.locale.language_code == LANGUAGE_CODE %}fw-bold{% endif %}"
                   hreflang="{{ t.locale.language_code }}"
                   href="{{ t.url }}">
                   {{ t.locale.get_display_name }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% endif %}

        <div class="dot-row" role="group" aria-label="{% trans 'Social links' %}">
          <a class="dot linkedin" href="https://www.linkedin.com/in/miriam-gradel/" target="_blank" rel="noopener" aria-label="LinkedIn">
            <i class="fa-brands fa-linkedin-in" aria-hidden="true"></i>
          </a>
          <a class="dot insta" href="https://www.instagram.com/migradel/" target="_blank" rel="noopener" aria-label="Instagram">
            <i class="fab fa-instagram" aria-hidden="true"></i>
          </a>
          <a class="dot bluesky" href="https://bsky.app/profile/mgradel.bsky.social" target="_blank" rel="noopener" aria-label="Bluesky">
            <svg viewBox="-50 -70 430 390" aria-hidden="true" height="1em" focusable="false">
              <path d="M180 141.964C163.699 110.262 119.308 51.1817 78.0347 22.044C38.4971 -5.86834 23.414 -1.03207 13.526 3.43594C2.08093 8.60755 0 26.1785 0 36.5164C0 46.8542 5.66748 121.272 9.36416 133.694C21.5786 174.738 65.0603 188.607 105.104 184.156C107.151 183.852 109.227 183.572 111.329 183.312C109.267 183.642 107.19 183.924 105.104 184.156C46.4204 192.847 -5.69621 214.233 62.6582 290.33C137.848 368.18 165.705 273.637 180 225.702C194.295 273.637 210.76 364.771 295.995 290.33C360 225.702 313.58 192.85 254.896 184.158C252.81 183.926 250.733 183.645 248.671 183.315C250.773 183.574 252.849 183.855 254.896 184.158C294.94 188.61 338.421 174.74 350.636 133.697C354.333 121.275 360 46.8568 360 36.519C360 26.1811 357.919 8.61012 346.474 3.43851C336.586 -1.02949 321.503 -5.86576 281.965 22.0466C240.692 51.1843 196.301 110.262 180 141.964Z"></path>
            </svg>
          </a>
          <a class="dot signal"
             href="https://signal.me/#eu/1dPcuFyexxyqAARMnHZBwZsRJZl3Phu6UT1uIUVZvae2LGtEevpNH6HVpChpWvwg"
             target="_blank" rel="noopener" aria-label="Signal">
            <i class="fa-solid fa-comment-dots" aria-hidden="true"></i>
          </a>
          <a class="dot line" href="https://line.me/ti/p/qlZvKkY-5W" target="_blank" rel="noopener" aria-label="Line">
            <i class="fa-brands fa-line" aria-hidden="true"></i>
          </a>
          <a class="dot mail" href="mailto:contact@miriamgradel.cc" aria-label="{% trans 'Email' %}">
            <i class="fa-solid fa-at" aria-hidden="true"></i>
          </a>
        </div>
      </div><!-- /menu-bottom -->

    </div><!-- /menu-container -->
  </aside>
  {% endcache %}
  {% endblock %}

  <!-- Drawer backdrop -->
  <div class="menu-backdrop d-lg-none" hidden></div>

  <!-- Mobile Top Bar -->
  <div class="mobile-top-bar d-lg-none">
    <div class="brand">
      <img src="{% static 'images/logo.png' %}" alt="" class="brand-logo" aria-hidden="true">
      <span class="brand-text">Miriam Gradel</span>
    </div>
    <div class="mobile-actions">
      <div class="topbar-btn">
        <a class="mobile-contact text-decoration-none text-reset"
           href="{{ work_url }}#contact"
           aria-label="{% trans 'Contact' %}">
           <i class="fa-regular fa-envelope" aria-hidden="true"></i>
           <span>{% trans 'Contact' %}</span>
        </a>
      </div>
      <button class="menu-open topbar-btn" type="button" aria-label="{% trans 'Open menu' %}" aria-expanded="false">
        <i class="fa-solid fa-bars" aria-hidden="true"></i>
      </button>
    </div>
  </div>

  <!-- Page content -->
  <main id="main-content">
    {% block content %}{% endblock %}
  </main>

  {# =================== FOOTER =================== #}
  <footer class="site-footer">
  {% slugurl 'work-with-me' as work_url %}

  {# Show CTA everywhere except WorkWithMePage #}
  {% if page and page.specific._meta.model_name != 'work-with-me' %}
    <section id="cta" class="cta-strip mt-5" aria-labelledby="cta-heading">
      <div class="cta-inner">
        <p id="cta-heading" class="cta-text m-0 me-3">{% trans "You have a project in mind?" %}</p>
        <a href="{{ work_url|default:'/work-with-me/' }}" class="cta-btn">
          {% trans "Let’s talk" %}
        </a>
      </div>
    </section>
  {% endif %}
    <div class="footer-inner">
      <div class="footer-col footer-meta">
        <p class="m-0">{% blocktrans %}The website is the property of <strong>Miriam Gradel</strong>.{% endblocktrans %}</p>
      </div>
      <nav class="footer-col footer-nav footer-nav--right" aria-label="{% trans 'Journalism links' %}">
        <ul class="footer-links">
          <li><a href="{{ written_url|default:'#' }}">{% trans "Written" %}</a></li>
          <li><a href="{{ audio_url|default:'#' }}">{% trans "Audio" %}</a></li>
          <li><a href="{{ videos_url|default:'#' }}">{% trans "Video" %}</a></li>
        </ul>
      </nav>

      <nav class="footer-col footer-nav footer-nav--right" aria-label="{% trans 'Other links' %}">
        <ul class="footer-links">
          <li><a href="{{ communication_url|default:'#' }}">{% trans "Communication" %}</a></li>
          <li><a href="{{ bts_url|default:'#' }}">{% trans "Behind the Scenes" %}</a></li>
          <li><a href="{{ work_url|default:'#' }}">{% trans "Work with Me" %}</a></li>
        </ul>
      </nav>

      <div class="footer-col footer-legal">
        <p class="m-0">
          {% trans "All rights reserved." %}
          {% if page and page.last_published_at %}
            {% blocktrans with y=page.last_published_at|date:"Y" %}Updated in {{ y }}.{% endblocktrans %}
          {% else %}
            {% now "Y" as current_year %}
            {% blocktrans with y=current_year %}Updated in {{ y }}.{% endblocktrans %}
          {% endif %}
          <br>
          {% trans "No cookies are used." %}
        </p>
        <p class="dev-note m-0">{% blocktrans %}Site by Larry's Studio{% endblocktrans %}</p>
      </div>
    </div>
  </footer>

  {# --- Scripts --- #}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <script src="{% static 'js/miriamgradel.js' %}" defer></script>

  <!-- Loading overlay fade-out (ensures clicks always pass through) -->
  <script>
    window.addEventListener('load', function () {
      const overlay = document.getElementById('loading-overlay');
      if (!overlay) return;
      overlay.style.pointerEvents = 'none';
      overlay.style.opacity = 0;
      const hide = () => { overlay.style.display = 'none'; };
      overlay.addEventListener('transitionend', hide, { once: true });
      setTimeout(hide, 1600);
    });
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>
