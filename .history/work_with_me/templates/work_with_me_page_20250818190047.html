{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags form_extras %}
{% load wme_qr %}


{% block body_class %}template-work-with-me{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/journalism.css' %}">{% endblock %}

{% block content %}
<section class="container my-5">

  <div class="wme-banner mb-4">
    <div class="wme-banner__stripe"></div>
    <div class="wme-banner__title"><span>{{ page.greeting|default:"Work with me" }}</span></div>
  </div>

  {% if page.intro %}<div class="mb-4">{{ page.intro|richtext }}</div>{% endif %}

  <div class="row g-4 align-items-start">
    <div class="col-lg-7">
      <h2 class="wme-section__title mb-3"><span>Tell me about your project</span></h2>

      <form action="{% pageurl page %}" method="post" novalidate>
        {% csrf_token %}

        {% for field in form.visible_fields %}
          <div class="mb-3">
            <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}{% if field.field.required %}*{% endif %}</label>
            {{ field|addcss:"form-control wme-input" }}
            {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
            {% for e in field.errors %}<div class="text-danger small">{{ e }}</div>{% endfor %}
          </div>
        {% endfor %}

        {# hidden fields incl. form_id etc. #}
        {% for hf in form.hidden_fields %}{{ hf }}{% endfor %}

        <button class="btn btn-dark" type="submit">Send message</button>
        {% comment %} {% if page.contact_email %}
          <div class="small text-muted mt-2">
            Prefer email? <a href="mailto:{% firstof page.contact_email page.to_address %}">{% firstof page.contact_email page.to_address %}</a>
          </div>
        {% endif %} {% endcomment %}
      </form>
    </div>

    <aside class="col-lg-5">

      {% if page.portrait %}
        <div class="wme-portrait mb-3">
          {% image page.portrait fill-720x900 class="img-fluid rounded" alt="Portrait" %}
        </div>
      {% endif %}
      <h2 class="wme-aside__title mb-2"><span>Contact details</span></h2>

      <ul class="list-unstyled">
        {# Auto-generate from qr_data/contact_email; renders nothing if segno missing #}
        {% wme_qr_svg page.get_qr_payload page.qr_scale as qr_svg %}
        {% if qr_svg %}
          <div class="wme-qr mt-3">{{ qr_svg }}</div>
        {% endif %}
        {% if page.phone_number %}
          <li class="mb-2"><strong>Phone:</strong> <a href="tel:{{ page.phone_number|cut:' ' }}">{{ page.phone_number }}</a></li>
        {% endif %}
        {% if page.contact_email or page.to_address %}
          <li class="mb-2"><strong>Email:</strong> <a href="mailto:{% firstof page.contact_email page.to_address %}">{% firstof page.contact_email page.to_address %}</a></li>
        {% endif %}
      </ul>
    </aside>
  </div>
</section>
{% endblock %}
